# UI自动化测试

## 有哪些测试类型？

前端测试主要分为 3 种：**单元测试（Unit Test）**、**集成测试（Integration Test）**、**UI 测试（UI Test）**

三种测试的占比分别为：

![测试金字塔](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7391f504a49740a696e03869aac48648~tplv-k3u1fbpfcp-watermark.awebp)

Google的自动化分层投入占比：

- 小测试（Unit）：占比70%；
- 中测试（Service）：占比20%；
- 大测试（UI）：占比10%；

## 什么是UI自动化测试？

### UI测试

简单来说，UI 测试是关于检查两件事：

- 你的应用程序如何处理通过鼠标、键盘和其他输入设备执行的用户操作。
- 视觉元素（按钮、链接、文本字段、图像等）是否正确显示并按预期工作。

### UI自动化测试

UI自动化测试，即通过模拟手动操作用户UI界面的方式，以代码方式实现自动操作和验证的一种自动化测试手段。

UI 测试（UI Test）和端到端测试（E2E Test）比较相似：

- UI 测试（UI Test）只是对于前端的测试，是脱离真实后端环境的，仅仅只是将前端放在真实环境中运行，而后端和数据都应该使用 Mock 的。
- 端到端测试（E2E Test）则是将整个应用放到真实的环境中运行，包括数据在内也是需要使用真实的。

因而我们需要在开发基本完成后进行相应的UI Test，在项目上线后进行E2E Test，在此统称为UI Test。

## UI自动化测试能解决什么问题？

1. 开发自测，重复性的功能测试及验证。
2. 兼容性测试。不管是Web测试，还是App测试，兼容性测试都是必不可少的一环。以Web测试为例，同样的测试用例，需要在不同的浏览器上分别运行一遍，这对测试人员而言不可谓不是一种折磨。

3. 发布后验证，避免疲惫操作时的人为测试遗漏。

4. 持续监控。

5. 回归测试。每一次应用发布，都伴随着一次回归测试。对于重复性的工作，机器显然更适合。

## 为什么要进行UI自动化测试

业务的更新迭代频繁，传统测试大部分都还是手工、肉眼的模式来进行，无法满足产品敏捷开发、快速迭代的需求。而UI自动化能让全功能的回归变得简单，释放纯手工测试的人力资源，并且回归测试能够覆盖到所有的逻辑场景，这对测试的效率，以及整个开发流程的效率都是很大的提升，并且能够规避很多人的主观和客观因素导致的漏测或者疏忽。

其他测试方式的局限性：

**单元测试（Unit Testing）**

事实上，单元测试确实能够帮助我们发现大部分的问题，但是在复杂的前端交互中，单纯的单元测试并不能真实地反映用户操作的路径，而单元测试一般的场景是测试一系列的功能集合。

**快照测试（Snapshot Testing）**

DOM结构并不能完全反映页面的视觉效果，DOM结构不变并不完全等于样式不变。此外，大多数工具都是React专用，非React应用基本不支持。

> 很多人认为，UI总是频繁的变动，导致测试用例维护成本高，性价比低，因此UI自动化测试比较适合场景稳定的业务。其实不是，这里的UI不仅仅指的是视觉，更多的是业务逻辑。UI可以多变，但业务逻辑一定是趋于稳定的，尤其是核心业务，想一想用户得多辛苦才能适应这种业务逻辑频繁变更的产品啊。

## 什么项目适合做UI自动化测试？

并不是任何应用产品都适合做自动化测试，选择自动化测试之前必须确认你的项目符合以下要求：软件需求变动不频繁、产品更新维护周期长、比较频繁的回归测试、自动化测试脚本可重复使用，否则光是准备大量的测试脚本就足以让测试人员崩溃。

## 哪些项目适合引入自动化测试？

现实中，我们经常会针对一些活动开发一些一次性的代码模块，这样的代码模块功能简单，且后续继续迭代的可能性低，这种代码就完全没有必要引入自动化测试工具。

**适合引入自动化测试的场景：**

1. 公共库类的开发维护
2. 中长期项目的迭代/重构
3. 引用了不可控的第三方依赖

这些场景是需要引入自动化测试来对现有代码进行约束的。**尤其是中长期项目，迭代/重构时人力回归困难，自动化测试就显得尤为重要！**

## 怎么做UI自动化测试？

#### 1. 验证逻辑而非UI

UI的验证会引入大量的不稳定因素。换句话说，像当年的测试大牛段念说的，你跑过了UI自动化，你就相信没问题了吗？不会相信，原因是啥？因为聪明的你会发现，你验证的东西越多，例如界面的每个按钮，颜色，排布，互联网应用变化最大的就是UI, 你的用例就越不稳定，所以你最终肯定不会验证全部UI。那结果就是"然并卵"了, 你根本不会相信这个用例真的通过了。因此给大家定个UI自动化能做的，验证逻辑（另外一种说法，说这种叫功能自动化）。什么叫验证逻辑？例如验证qq是否登录成功，验证到了好友列表，就是登录成功，甚至有登录成功的日志都可以，怎么稳定怎么行。

#### 2.代替大量的UI重复操作

简单来说就是UI自动化你要投入5元，只是执行4次，每次赚5毛的话，那你还亏3元的问题。什么时候会大量呢？像手Q, 编译百个市场的包，每个包要验证核心功能。或者像性能ui自动化监控，同一个用例为了多次采样，也会执行多次。还有每日构建，集成，都可以。关键点就是用次数来增加价值，UI自动化能帮你确保不出死人的问题，如登录不了，登录了又卡死，或者是监控UI之外的其他，如性能。这些都有机会让其价值高于成本的。

### UI测试的范围

以下是 UI 测试倾向于验证的一些基本测试用例：

- **数据类型错误**：测试检查是否只能为某些数据字段输入有效数据，例如日期、货币等。
- **字段宽度**：该测试检查某些文本字段是否不允许用户将输入置于特定字符限制之上。 
- **导航元素**：测试检查页面上的所有导航按钮是否正常工作，以及它们是否将用户重定向到正确的页面。
- **进度条**：该测试检查在显示需要时间才能完全加载的页面或屏幕时，是否会出现一个进度条，让用户知道页面正在加载。
- **预先输入**：如果 UI 使用下拉列表，则需要预先输入。在具有多个选项的下拉菜单中，用户应该能够通过键入第一个字母来找到正确的选项。让用户通过长长的列表构成不利的用户体验。
- **表格滚动**：如果网站有数据表格，并且表格扩展到第二页，那么用户应该能够滚动浏览所有数据，同时保持标题可见并就位。
- **错误记录**：此测试检查是否出现系统错误，软件会将错误详细信息记录到日志文件中，以便稍后查看。
- **菜单项**：该测试检查软件是否仅显示其特定地理位置（如果适用）中可用的菜单。
- **工作快捷方式**：如果软件支持快捷方式，此测试将验证它们中的每一个都可以在多个浏览器、平台和设备上按预期工作。

除了这些测试之外，建议在重要的端到端用户进程上运行 UI 测试。例如，在此过程中涉及的用户操作上运行 UI 测试：**登录 > 将商品添加到购物车 > 查看购物车 > 付款 > 输入送货地址 > 立即购买**。由于这是通过电子商务网站的常见用户旅程，测试人员必须确保它可以在没有任何中断或故障的情况下完成。否则，该网站可能会失去收入和流量。

## Three.js的E2E方案

### 1. 确定正确期待值: 创建期望正确渲染的截图快照。

- 启动一个静态文件的HTTP服务，加载 Three.js 本地的示例。
- 用无头浏览器(Headless browser) 访问示例，并保存3D正确效果的截图快照。
- 关闭HTTP服务。

![img](https://pic1.zhimg.com/50/v2-6b969b1d8f1db46c0965b0db1576810a_720w.jpg?source=1940ef5c)

### 2. 比对迭代前后差异:

- 启动一个静态文件的HTTP服务，加载 Three.js 本地的示例。
- 用无头浏览器(Headless browser) 访问迭代后的示例，并将原有正确效果的图片做图片像素的差异匹配。如果匹配结果像素差异度大于 0.5% 就是测试用例失败。
- 关闭静态HTTP服务。

![img](https://pic1.zhimg.com/50/v2-7bc758ccc6125a973e22a776f0ae59df_720w.jpg?source=1940ef5c)

### 3. 让差异可视化

- 用 jimp 把匹配差异的像素标记给保存成图片，方便查看差异

![img](https://pic1.zhimg.com/50/v2-2cfb61c427fefd3764b40b3b3c4adc01_720w.jpg?source=1940ef5c)

- 第一张图片为预期正确结果。
- 第二张图片加了蓝色的圆环，为错误结果。
- 第三张图片是对比了预期和错误结果后，用红色像素标记出差异点。

修改后的链路流程图大致如下  

![img](https://pic3.zhimg.com/80/v2-e8f33138c88c3c0928640158f6b887cf_720w.jpg?source=1940ef5c)



### 完整的测试链路

![img](https://pic1.zhimg.com/50/v2-f6a305b16578d0270109cb938e123e56_720w.jpg?source=1940ef5c)

## 什么样的项目适合自动化测试

性价比：按照测试金字塔模型以及投入/产出比，越向下，回报率越高；

Google的自动化分层投入占比：

- 小测试（Unit）：占比70%；
- 中测试（Service）：占比20%；
- 大测试（UI）：占比10%；

自动化测试面临的挑战：面临的最大挑战就是变化，因为变化会导致测试用例运行失败，所以需要对自动化脚本不断debug，如何控制成本、降低成本是对自动化测试工具以及人员能力的挑战。



![img](https://pic1.zhimg.com/80/v2-684651e3457ecce81212ba1a4f953530_720w.jpg)

### 功能自动化测试的条件：

- 需求相对稳定
- 冒烟测试通过
- 测试周期长

## selenium

Selenium是一个用于Web应用程序测试的工具。Selenium测试直接运行在浏览器中，就像真正的用户在操作一样。支持的浏览器包括IE(7、8、9)、Mozilla Firefox、Mozilla Suite等。这个工具的主要功能包括：测试与浏览器的兼容性——测试你的应用程序看是否能够很好得工作在不同浏览器和操作系统之上。测试系统功能——创建回归测试检验软件功能和用户需求。支持自动录制动作和自动生成 .Net、Java、Perl等不同语言的测试脚本。Selenium 是ThoughtWorks专门为Web应用程序编写的一个验收测试工具。其升级版本为Webdriver。

- Selenium IDE: 一款Firefox插件，以图形化方式支持录制脚本、自动生成脚本等功能。用于本地开发和调试TC（Test Case）。
- Selenium WebDriver: 通过各浏览器厂商提供的原生Driver，指挥浏览器进行各类页面操作。
- Selenium Grid: 适用于分布式环境下运行大量的TC，Hub根据TC的环境要求分发给各个符合条件的Node执行。使用Selenium Grid可以轻松搭建一个分布式的自动化测试环境，特别适合运行大规模的测试用例和兼容性测试（各个节点运行不同的WebDriver）![img](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/5/15/7a6f2962d7b9a634d492316d5a8a74ab~tplv-t2oaga2asx-watermark.awebp)

## demo



## 你的基本 UI 测试备忘单。

UI 测试——就像任何其他类型的测试一样——可以非常广泛。因此，不可能在一篇博文中涵盖有关此技术的所有知识。但是，我们可以做的是为您提供一份备忘单，其中包含一个基本的 UI 测试清单，您可以在需要时随时查阅。闲话少说，这里是：

- **一致性**。验证您的应用或网站在颜色、字体类型和其他视觉元素方面是否一致。这通常是手动测试。
- **拼写。**检查整个应用程序中的拼写错误，不仅在标题、菜单和其他文本正文中，而且在错误消息和其他信息元素中。这通常是在拼写检查工具的帮助下在探索性测试中手动完成的。
- **排版。**文本是否易于阅读？它与背景的对比度是否足够？用户是否容易区分不同的 UI 元素（例如，标题和非标题文本之间，或者链接和常规文本之间）？这主要是手动视觉测试。
- **交互元素的行为。**按钮、点击、悬停、拖放等是否按预期工作？这涉及网站的核心功能，其中大部分都可以自动化。
- **功能验证。**输入是否产生预期的输出？例如，如果您“将商品添加到购物车”，您需要验证正确的商品、价格和数量是否已正确添加到购物车。是否有验证以防止用户输入不合理的数据，例如不允许的负数或特殊字符？您能否验证未违反字符长度限制或所需格式（例如电话号码）？这些通常可以自动化。
- **适应性。**设备、浏览器、屏幕格式和尺寸以及操作系统种类繁多，令人难以置信。确保 UI 元素适应并在这些不同的场景中正确显示。跨浏览器测试工具旨在测试跨不同显示器和设备的自动化。
